import{r as l,j as e,b as S,g as Ye}from"./router-0uN5aety.js";import{b as ae,B as v}from"./button-B296d654.js";import{B as J,C as Ze}from"./badge-CcjedXCD.js";import{C as Je,a as Qe,b as et,d as tt}from"./card-BUhaSKxx.js";import{c as x,u as P,S as at,b as st}from"./utils-BAO6HRzK.js";import{p as C}from"./pocketbase-BwiBgDV-.js";import{c as se,b as R,P as U,D as ot,f as rt,u as nt,d as it}from"./index-BJT6Mi-p.js";import{R as lt,h as ct,u as dt,F as ut,a as L,A as Q,T as ee}from"./index-DmaFZOmD.js";import{P as _}from"./index-CJOOd4Gm.js";import{r as pt}from"./requireAuth-BROCRZK-.js";import{L as mt,I as ft}from"./label-gcoyWlSz.js";import{p as gt,q as xt,n as ht,o as vt}from"./components-BFRM7CUx.js";import{c as D}from"./createLucideIcon-luw-QPq7.js";import{D as yt}from"./database-BJ0OeOBJ.js";import{r as jt}from"./responses-BDgPukry.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=D("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=D("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=D("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=D("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=D("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=D("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=D("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=D("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),oe=l.forwardRef(({className:a,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:x("w-full caption-bottom text-sm",a),...s})}));oe.displayName="Table";const re=l.forwardRef(({className:a,...s},t)=>e.jsx("thead",{ref:t,className:x("[&_tr]:border-b",a),...s}));re.displayName="TableHeader";const ne=l.forwardRef(({className:a,...s},t)=>e.jsx("tbody",{ref:t,className:x("[&_tr:last-child]:border-0",a),...s}));ne.displayName="TableBody";const Tt=l.forwardRef(({className:a,...s},t)=>e.jsx("tfoot",{ref:t,className:x("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...s}));Tt.displayName="TableFooter";const F=l.forwardRef(({className:a,...s},t)=>e.jsx("tr",{ref:t,className:x("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...s}));F.displayName="TableRow";const b=l.forwardRef(({className:a,...s},t)=>e.jsx("th",{ref:t,className:x("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s}));b.displayName="TableHead";const N=l.forwardRef(({className:a,...s},t)=>e.jsx("td",{ref:t,className:x("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s}));N.displayName="TableCell";const Et=l.forwardRef(({className:a,...s},t)=>e.jsx("caption",{ref:t,className:x("mt-4 text-sm text-muted-foreground",a),...s}));Et.displayName="TableCaption";var V="Dialog",[ie,le]=se(V),[St,y]=ie(V),ce=a=>{const{__scopeDialog:s,children:t,open:o,defaultOpen:r,onOpenChange:n,modal:i=!0}=a,p=l.useRef(null),f=l.useRef(null),[c=!1,u]=nt({prop:o,defaultProp:r,onChange:n});return e.jsx(St,{scope:s,triggerRef:p,contentRef:f,contentId:L(),titleId:L(),descriptionId:L(),open:c,onOpenChange:u,onOpenToggle:l.useCallback(()=>u(h=>!h),[u]),modal:i,children:t})};ce.displayName=V;var de="DialogTrigger",ue=l.forwardRef((a,s)=>{const{__scopeDialog:t,...o}=a,r=y(de,t),n=P(s,r.triggerRef);return e.jsx(_.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":Y(r.open),...o,ref:n,onClick:R(a.onClick,r.onOpenToggle)})});ue.displayName=de;var X="DialogPortal",[Pt,pe]=ie(X,{forceMount:void 0}),me=a=>{const{__scopeDialog:s,forceMount:t,children:o,container:r}=a,n=y(X,s);return e.jsx(Pt,{scope:s,forceMount:t,children:l.Children.map(o,i=>e.jsx(U,{present:t||n.open,children:e.jsx(it,{asChild:!0,container:r,children:i})}))})};me.displayName=X;var B="DialogOverlay",fe=l.forwardRef((a,s)=>{const t=pe(B,a.__scopeDialog),{forceMount:o=t.forceMount,...r}=a,n=y(B,a.__scopeDialog);return n.modal?e.jsx(U,{present:o||n.open,children:e.jsx(_t,{...r,ref:s})}):null});fe.displayName=B;var _t=l.forwardRef((a,s)=>{const{__scopeDialog:t,...o}=a,r=y(B,t);return e.jsx(lt,{as:at,allowPinchZoom:!0,shards:[r.contentRef],children:e.jsx(_.div,{"data-state":Y(r.open),...o,ref:s,style:{pointerEvents:"auto",...o.style}})})}),A="DialogContent",ge=l.forwardRef((a,s)=>{const t=pe(A,a.__scopeDialog),{forceMount:o=t.forceMount,...r}=a,n=y(A,a.__scopeDialog);return e.jsx(U,{present:o||n.open,children:n.modal?e.jsx(Ot,{...r,ref:s}):e.jsx(It,{...r,ref:s})})});ge.displayName=A;var Ot=l.forwardRef((a,s)=>{const t=y(A,a.__scopeDialog),o=l.useRef(null),r=P(s,t.contentRef,o);return l.useEffect(()=>{const n=o.current;if(n)return ct(n)},[]),e.jsx(xe,{...a,ref:r,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:R(a.onCloseAutoFocus,n=>{var i;n.preventDefault(),(i=t.triggerRef.current)==null||i.focus()}),onPointerDownOutside:R(a.onPointerDownOutside,n=>{const i=n.detail.originalEvent,p=i.button===0&&i.ctrlKey===!0;(i.button===2||p)&&n.preventDefault()}),onFocusOutside:R(a.onFocusOutside,n=>n.preventDefault())})}),It=l.forwardRef((a,s)=>{const t=y(A,a.__scopeDialog),o=l.useRef(!1),r=l.useRef(!1);return e.jsx(xe,{...a,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:n=>{var i,p;(i=a.onCloseAutoFocus)==null||i.call(a,n),n.defaultPrevented||(o.current||(p=t.triggerRef.current)==null||p.focus(),n.preventDefault()),o.current=!1,r.current=!1},onInteractOutside:n=>{var f,c;(f=a.onInteractOutside)==null||f.call(a,n),n.defaultPrevented||(o.current=!0,n.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const i=n.target;((c=t.triggerRef.current)==null?void 0:c.contains(i))&&n.preventDefault(),n.detail.originalEvent.type==="focusin"&&r.current&&n.preventDefault()}})}),xe=l.forwardRef((a,s)=>{const{__scopeDialog:t,trapFocus:o,onOpenAutoFocus:r,onCloseAutoFocus:n,...i}=a,p=y(A,t),f=l.useRef(null),c=P(s,f);return dt(),e.jsxs(e.Fragment,{children:[e.jsx(ut,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:r,onUnmountAutoFocus:n,children:e.jsx(ot,{role:"dialog",id:p.contentId,"aria-describedby":p.descriptionId,"aria-labelledby":p.titleId,"data-state":Y(p.open),...i,ref:c,onDismiss:()=>p.onOpenChange(!1)})}),e.jsxs(e.Fragment,{children:[e.jsx(Ft,{titleId:p.titleId}),e.jsx($t,{contentRef:f,descriptionId:p.descriptionId})]})]})}),K="DialogTitle",he=l.forwardRef((a,s)=>{const{__scopeDialog:t,...o}=a,r=y(K,t);return e.jsx(_.h2,{id:r.titleId,...o,ref:s})});he.displayName=K;var ve="DialogDescription",ye=l.forwardRef((a,s)=>{const{__scopeDialog:t,...o}=a,r=y(ve,t);return e.jsx(_.p,{id:r.descriptionId,...o,ref:s})});ye.displayName=ve;var je="DialogClose",Ne=l.forwardRef((a,s)=>{const{__scopeDialog:t,...o}=a,r=y(je,t);return e.jsx(_.button,{type:"button",...o,ref:s,onClick:R(a.onClick,()=>r.onOpenChange(!1))})});Ne.displayName=je;function Y(a){return a?"open":"closed"}var De="DialogTitleWarning",[Mt,we]=rt(De,{contentName:A,titleName:K,docsSlug:"dialog"}),Ft=({titleId:a})=>{const s=we(De),t=`\`${s.contentName}\` requires a \`${s.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${s.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${s.docsSlug}`;return l.useEffect(()=>{a&&(document.getElementById(a)||console.error(t))},[t,a]),null},Bt="DialogDescriptionWarning",$t=({contentRef:a,descriptionId:s})=>{const o=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${we(Bt).contentName}}.`;return l.useEffect(()=>{var n;const r=(n=a.current)==null?void 0:n.getAttribute("aria-describedby");s&&r&&(document.getElementById(s)||console.warn(o))},[o,a,s]),null},Lt=ce,zt=ue,Ht=me,Gt=fe,Wt=ge,qt=he,Ut=ye,be=Ne,Ae="AlertDialog",[Vt,ba]=se(Ae,[le]),j=le(),ke=a=>{const{__scopeAlertDialog:s,...t}=a,o=j(s);return e.jsx(Lt,{...o,...t,modal:!0})};ke.displayName=Ae;var Xt="AlertDialogTrigger",Kt=l.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...o}=a,r=j(t);return e.jsx(zt,{...r,...o,ref:s})});Kt.displayName=Xt;var Yt="AlertDialogPortal",Ce=a=>{const{__scopeAlertDialog:s,...t}=a,o=j(s);return e.jsx(Ht,{...o,...t})};Ce.displayName=Yt;var Zt="AlertDialogOverlay",Re=l.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...o}=a,r=j(t);return e.jsx(Gt,{...r,...o,ref:s})});Re.displayName=Zt;var T="AlertDialogContent",[Jt,Qt]=Vt(T),Te=l.forwardRef((a,s)=>{const{__scopeAlertDialog:t,children:o,...r}=a,n=j(t),i=l.useRef(null),p=P(s,i),f=l.useRef(null);return e.jsx(Mt,{contentName:T,titleName:Ee,docsSlug:"alert-dialog",children:e.jsx(Jt,{scope:t,cancelRef:f,children:e.jsxs(Wt,{role:"alertdialog",...n,...r,ref:p,onOpenAutoFocus:R(r.onOpenAutoFocus,c=>{var u;c.preventDefault(),(u=f.current)==null||u.focus({preventScroll:!0})}),onPointerDownOutside:c=>c.preventDefault(),onInteractOutside:c=>c.preventDefault(),children:[e.jsx(st,{children:o}),e.jsx(ta,{contentRef:i})]})})})});Te.displayName=T;var Ee="AlertDialogTitle",Se=l.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...o}=a,r=j(t);return e.jsx(qt,{...r,...o,ref:s})});Se.displayName=Ee;var Pe="AlertDialogDescription",_e=l.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...o}=a,r=j(t);return e.jsx(Ut,{...r,...o,ref:s})});_e.displayName=Pe;var ea="AlertDialogAction",Oe=l.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...o}=a,r=j(t);return e.jsx(be,{...r,...o,ref:s})});Oe.displayName=ea;var Ie="AlertDialogCancel",Me=l.forwardRef((a,s)=>{const{__scopeAlertDialog:t,...o}=a,{cancelRef:r}=Qt(Ie,t),n=j(t),i=P(s,r);return e.jsx(be,{...n,...o,ref:i})});Me.displayName=Ie;var ta=({contentRef:a})=>{const s=`\`${T}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${T}\` by passing a \`${Pe}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${T}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{var o;document.getElementById((o=a.current)==null?void 0:o.getAttribute("aria-describedby"))||console.warn(s)},[s,a]),null},aa=ke,sa=Ce,Fe=Re,Be=Te,$e=Oe,Le=Me,ze=Se,He=_e;const te=aa,oa=sa,Ge=l.forwardRef(({className:a,...s},t)=>e.jsx(Fe,{className:x("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t}));Ge.displayName=Fe.displayName;const z=l.forwardRef(({className:a,...s},t)=>e.jsxs(oa,{children:[e.jsx(Ge,{}),e.jsx(Be,{ref:t,className:x("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]}));z.displayName=Be.displayName;const H=({className:a,...s})=>e.jsx("div",{className:x("flex flex-col space-y-2 text-center sm:text-left",a),...s});H.displayName="AlertDialogHeader";const G=({className:a,...s})=>e.jsx("div",{className:x("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});G.displayName="AlertDialogFooter";const W=l.forwardRef(({className:a,...s},t)=>e.jsx(ze,{ref:t,className:x("text-lg font-semibold",a),...s}));W.displayName=ze.displayName;const We=l.forwardRef(({className:a,...s},t)=>e.jsx(He,{ref:t,className:x("text-sm text-muted-foreground",a),...s}));We.displayName=He.displayName;const ra=l.forwardRef(({className:a,...s},t)=>e.jsx($e,{ref:t,className:x(ae(),a),...s}));ra.displayName=$e.displayName;const q=l.forwardRef(({className:a,...s},t)=>e.jsx(Le,{ref:t,className:x(ae({variant:"outline"}),"mt-2 sm:mt-0",a),...s}));q.displayName=Le.displayName;var qe={exports:{}};(function(a,s){(function(t,o){o()})(S,function(){function t(c,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c}function o(c,u,h){var m=new XMLHttpRequest;m.open("GET",c),m.responseType="blob",m.onload=function(){f(m.response,u,h)},m.onerror=function(){console.error("could not download file")},m.send()}function r(c){var u=new XMLHttpRequest;u.open("HEAD",c,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function n(c){try{c.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),c.dispatchEvent(u)}}var i=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof S=="object"&&S.global===S?S:void 0,p=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),f=i.saveAs||(typeof window!="object"||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!p?function(c,u,h){var m=i.URL||i.webkitURL,g=document.createElement("a");u=u||c.name||"download",g.download=u,g.rel="noopener",typeof c=="string"?(g.href=c,g.origin===location.origin?n(g):r(g.href)?o(c,u,h):n(g,g.target="_blank")):(g.href=m.createObjectURL(c),setTimeout(function(){m.revokeObjectURL(g.href)},4e4),setTimeout(function(){n(g)},0))}:"msSaveOrOpenBlob"in navigator?function(c,u,h){if(u=u||c.name||"download",typeof c!="string")navigator.msSaveOrOpenBlob(t(c,h),u);else if(r(c))o(c,u,h);else{var m=document.createElement("a");m.href=c,m.target="_blank",setTimeout(function(){n(m)})}}:function(c,u,h,m){if(m=m||open("","_blank"),m&&(m.document.title=m.document.body.innerText="downloading..."),typeof c=="string")return o(c,u,h);var g=c.type==="application/octet-stream",$=/constructor/i.test(i.HTMLElement)||i.safari,O=/CriOS\/[\d]+/.test(navigator.userAgent);if((O||g&&$||p)&&typeof FileReader<"u"){var k=new FileReader;k.onloadend=function(){var w=k.result;w=O?w:w.replace(/^data:[^;]*;/,"data:attachment/file;"),m?m.location.href=w:location=w,m=null},k.readAsDataURL(c)}else{var I=i.URL||i.webkitURL,E=I.createObjectURL(c);m?m.location=E:location.href=E,m=null,setTimeout(function(){I.revokeObjectURL(E)},4e4)}});i.saveAs=f.saveAs=f,a.exports=f})})(qe);var na=qe.exports;const ia=Ye(na),{saveAs:la}=ia,Aa=()=>[{title:"Backup Task Details"}],ka=async({params:a,request:s})=>{var f;await pt();const t=new URL(s.url),o=parseInt(t.searchParams.get("page")||"1",10),r=10,n=a.id;var i=null;const p=await C.collection("backups").getList(o,r,{filter:`task = "${n}"`,sort:"-created",expand:"task"});return p.items.length>0?i=(f=p.items[0].expand)==null?void 0:f.task:i=await C.collection("tasks").getOne(n),{task:i,backups:{items:p.items,totalPages:p.totalPages}}},Ca=async({params:a,request:s})=>{const t=await s.formData(),o=t.get("intent");if(o==="deleteTask")return await C.collection("tasks").delete(a.id),jt("/");if(o==="deleteBackup"){const r=t.get("backupId");return await C.collection("backups").delete(r),{success:!0,message:"Backup deleted successfully"}}else if(o==="toggleTaskStatus"){const r=a.id,i=t.get("currentStatus")==="Active"?"Paused":"Active";return await C.collection("tasks").update(r,{status:i}),{success:!0,message:`Task ${i.toLowerCase()} successfully`}}else if(o==="updateTaskSettings"){const r=a.id,n=t.get("cron");return await C.collection("tasks").update(r,{cron:n}),{success:!0,message:"Task settings updated successfully"}}else if(o==="downloadBackup"){const r=t.get("backupId"),n=t.get("backupFilename"),i=await fetch(`undefined/api/backups/${r}/download`,{method:"GET"});if(!i.ok)return{error:(await i.json()).message||"Failed to download backup"};const p=await i.blob();return la(p,n||"backup.sql"),{success:!0,message:"Backup downloaded successfully"}}else if(o==="runBackupNow"){const r=a.id,n=await fetch(`undefined/api/tasks/${r}/run`,{method:"POST"});return n.ok?{success:!0,message:"Backup started successfully"}:{error:(await n.json()).message||"Failed to run backup"}}return{success:!1}};function Ra(){const a=gt(),s=xt(),{task:t,backups:o}=ht(),[r,n]=l.useState(1),[i,p]=l.useState(null),[f,c]=l.useState(!1),[u,h]=l.useState(t.cron),m=d=>{switch(d){case"Active":return"default";case"Paused":return"secondary";case"Error":return"destructive";default:return"default"}},g=d=>new Date(d).toLocaleString(),$=d=>d<60?`${d} sec`:d<3600?`${Math.floor(d/60)} min`:`${Math.floor(d/3600)} hour${d>=7200?"s":""}`,O=d=>{if(d===0)return"0 Bytes";const M=1024,Ke=["Bytes","KB","MB","GB","TB"],Z=Math.floor(Math.log(d)/Math.log(M));return parseFloat((d/Math.pow(M,Z)).toFixed(2))+" "+Ke[Z]},k=d=>{n(d),a(`?page=${d}`)},I=async()=>{window.confirm("Are you sure you want to delete this task?")&&s({intent:"deleteTask"},{method:"post",action:`/tasks/${t.id}`,replace:!0})},E=async d=>{window.confirm("Are you sure you want to delete this backup?")&&s({intent:"deleteBackup",backupId:d},{method:"post",action:`/tasks/${t.id}`})},w=d=>{p(d)},Ue=async()=>{s({intent:"toggleTaskStatus",currentStatus:t.status},{method:"post",action:`/tasks/${t.id}`})},Ve=async d=>{d.preventDefault(),s({intent:"updateTaskSettings",cron:u},{method:"post",action:`/tasks/${t.id}`}),c(!1)},Xe=d=>{s({intent:"downloadBackup",backupId:d.id,backupFilename:d.filename},{method:"post",action:`/tasks/${t.id}`})};return t?e.jsxs("div",{children:[e.jsxs(v,{className:"mb-4",variant:"ghost",onClick:()=>a("/"),children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Back to Tasks"]}),e.jsxs(Je,{className:"w-full",children:[e.jsxs(Qe,{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx(et,{className:"text-2xl font-bold",children:t.name}),e.jsx(J,{variant:m(t.status),children:t.status}),e.jsxs("div",{className:"flex items-center mt-2 space-x-4",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(yt,{className:"mr-2 h-4 w-4"}),t.dbConfig.type]}),t.storageConfigs.map((d,M)=>e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),d.type]},M))]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(v,{size:"sm",onClick:Ue,children:[t.status==="Active"?e.jsx(kt,{className:"mr-2 h-4 w-4"}):e.jsx(Ct,{className:"mr-2 h-4 w-4"}),t.status==="Active"?"Pause":"Resume"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>c(!0),children:[e.jsx(Rt,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(v,{variant:"destructive",size:"sm",onClick:I,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}),e.jsxs(tt,{className:"",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 bg-secondary/20 rounded-lg ",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Schedule"}),e.jsx("p",{children:t.cron||"Not configured"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Last Backup"}),e.jsx("p",{children:t.lastBackup?g(t.lastBackup):"Not performed"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Next Backup"}),e.jsx("p",{children:t.status==="Active"?t.nextBackup?g(t.nextBackup):"Not scheduled":"Paused"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Retention Policy"}),e.jsx("p",{children:t.retentionDays?`${t.retentionDays} days`:"Not configured"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Backup History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(oe,{children:[e.jsx(re,{children:e.jsxs(F,{children:[e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Size"}),e.jsx(b,{children:"Duration"}),e.jsx(b,{children:"Start Time"}),e.jsx(b,{children:"End Time"}),e.jsx(b,{children:"Actions"})]})}),e.jsx(ne,{children:o.items.length>0?o.items.map(d=>e.jsxs(F,{children:[e.jsx(N,{children:e.jsx(J,{variant:d.status==="Completed"?"default":"destructive",children:d.status})}),e.jsx(N,{children:d.size?O(d.size):"N/A"}),e.jsx(N,{children:d.duration?$(Number(d.duration.toFixed(0))):"N/A"}),e.jsx(N,{children:g(d.startTime)}),e.jsx(N,{children:d.endTime?g(d.endTime):"In progress"}),e.jsx(N,{children:e.jsxs("div",{className:"flex space-x-2",children:[d.status==="Failed"&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>w(d),children:[e.jsx(wt,{className:"h-4 w-4 mr-2"}),"View Error"]}),d.status==="Completed"&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>Xe(d),children:[e.jsx(At,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsxs(v,{variant:"destructive",size:"sm",onClick:()=>E(d.id),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Delete"]})]})})]},d.id)):e.jsx(F,{children:e.jsx(N,{colSpan:6,className:"text-center",children:"No backups recorded"})})})]})}),e.jsxs("div",{className:"flex justify-center items-center mt-4",children:[e.jsxs(v,{onClick:()=>k(r-1),disabled:r===1,variant:"outline",size:"sm",children:[e.jsx(Nt,{className:"h-4 w-4 mr-2"}),"Previous"]}),e.jsxs("span",{className:"mx-4",children:["Page ",r," of ",o.totalPages]}),e.jsxs(v,{onClick:()=>k(r+1),disabled:r===o.totalPages,variant:"outline",size:"sm",children:["Next",e.jsx(Dt,{className:"h-4 w-4 ml-2"})]})]})]})]})]}),e.jsx(te,{open:!!i,onOpenChange:()=>p(null),children:e.jsxs(z,{children:[e.jsxs(H,{children:[e.jsx(W,{children:"Backup Error"}),e.jsx(We,{children:(i==null?void 0:i.error)||"The backup could not be completed."})]}),e.jsx(G,{children:e.jsx(q,{children:"Close"})})]})}),e.jsx(te,{open:f,onOpenChange:c,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(W,{children:"Edit Task"})}),e.jsxs("form",{onSubmit:Ve,children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(mt,{htmlFor:"cron",children:"Cron Schedule"}),e.jsx(ft,{id:"cron",value:u,onChange:d=>h(d.target.value),placeholder:"0 0 * * *"})]})}),e.jsxs(G,{className:"mt-4",children:[e.jsx(q,{type:"button",children:"Cancel"}),e.jsx(v,{type:"submit",children:"Save Changes"})]})]})]})})]}):e.jsxs("div",{className:"container mx-auto p-8 flex flex-col items-center justify-center min-h-screen",children:[e.jsx(bt,{className:"h-24 w-24 text-gray-400 mb-6"}),e.jsx("h2",{className:"text-3xl font-bold text-center mb-4",children:"Task not found"}),e.jsx("p",{className:"text-xl text-gray-600 text-center mb-8",children:"The backup task you're looking for doesn't exist or has been deleted."}),e.jsx(v,{asChild:!0,children:e.jsxs(vt,{to:"/",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Back to Tasks"]})})]})}export{Ca as clientAction,ka as clientLoader,Ra as default,Aa as meta};
